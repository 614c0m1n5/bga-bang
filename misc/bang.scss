/**
 *------
 * BGA framework: © Gregory Isabelli <gisabelli@boardgamearena.com> & Emmanuel Colin <ecolin@boardgamearena.com>
 * bang implementation : © <Your name here> <Your email address here>
 *
 * This code has been produced on the BGA studio platform for use on http://boardgamearena.com.
 * See http://en.boardgamearena.com/#!doc/Studio for more information.
 * -----
 *
 * bang.css
 *
 * bang stylesheet
 *
 */

 @font-face {
     font-family: 'Perdido';
     src:url('img/fonts/PerdidoDemo.ttf') format('truetype');
     font-weight: normal;
     font-style: normal;
     font-display: swap;
}

@font-face {
    font-family: 'Palatino Linotype';
    src: url('img/fonts/PalatinoLinotype-Italic.woff2') format('woff2'),
        url('img/fonts/PalatinoLinotype-Italic.woff') format('woff'),
        url('img/fonts/PalatinoLinotype-Italic.ttf') format('truetype');
    font-weight: normal;
    font-style: italic;
    font-display: swap;
}

$transparentWhite:rgba(255,255,255,0.5);
$darkgray: rgba(50,50,50, 0.8);

$numberOfSymbols:15;
$numberOfCharacters:15;
$numberOfCards:21;
$guns: 0,1,2,3,4;
$actions: 5,6,7,8,9,10,11,12,13,14,15,16;
$equipments: 17,18,19,20,21;
$cardH: 170px;
$cardW: $cardH / 200 * 125;


$layoutBig:(
  3:(
    "table":("col" : 3, "row" : 4, "align" : center),
    0:("col" : 3, "row" : 2, "align": center),
    1:("col" : 5, "row" : 4, "align": left),
    2:("col" : 1, "row" : 4, "align": right),
  ),
  4:(
    "table":("col" : 3, "row" : 4, "align" : center),
    0:("col" : 3, "row" : 2, "align": center),
    1:("col" : 5, "row" : 4, "align": left),
    2:("col" : 3, "row" : 6, "align": center),
    3:("col" : 1, "row" : 4, "align": right),
  ),
  5:(
    "table":("col" : 3, "row" : 4, "align" : center),
    0:("col" : 3, "row" : 2, "align": center),
    1:("col" : 5, "row" : 4, "align": left),
    2:("col" : 4, "row" : 6, "align": center),
    3:("col" : 2, "row" : 6, "align": center),
    4:("col" : 1, "row" : 4, "align": right),
  )
);

.player-board {
  .player-role {
    width:40px;
    height:40px;
    background-size:contain;
    background-repeat:no-repeat;
    position:absolute;
    top:0;
    right:45px;

    &[data-role="0"] { background-image:url("img/sheriff.svg"); }
    &[data-role="1"] { background-image:url("img/deputy.svg"); }
    &[data-role="2"] { background-image:url("img/outlaw.svg"); }
    &[data-role="3"] { background-image:url("img/renegade.svg"); }
  }
}
.player-board.eliminated {
  background-color: #BBB !important;

  .player_board_inner {
    .player_table_status { display:none !important; }

    &::before {
      content: "";
      display: block;
      width: 35px;
      height: 35px;
      background-image: url("img/dead.svg");
      position: absolute;
      z-index: 3;
      background-color: white;
      border-radius: 50%;
      background-size: 88%;
      background-position: center center;
      background-repeat: no-repeat;
      top: 4px;
      left: 1px;
    }
  }
}


div#board {
	width:100%;
	min-height:800px;
	position:relative;
	display:grid;
	grid-template-columns: repeat(6, 1fr);

  div#hand {
  	background-color:$transparentWhite;
  	border-radius: 5px;
  	grid-row:1;
  	grid-column:1 / span 6;
  	height:$cardH + 15px;
  	display:flex;
  	flex-flow:row;

    div#role-container {
      flex-grow:0;
      width:$cardW + 15px;
      display:flex;
      align-items: center;
      justify-content: center;
      background-color:white;

      div#role-card {
        height:$cardH;
        width:$cardW - 1px;
        background-image:url("img/roles.png");
        background-size:cover;

        div#role-name {
          width:100%;
          font-family: "Perdido";
          font-size:23px;
          text-align: center;
          margin-top:9px;
        }

        div#role-text {
          font-family:'Palatino Linotype';
          font-style:italic;
          font-size:9px;
          margin-top:98px;
          text-align:center;
        }
      }

      @for $i from 0 through 3 {
        &[data-role="#{$i}"] div#role-card { background-position:$i*100%/3 center; }
      }
    }



    div#hand-cards {
      flex-grow:1;
      display:flex;
    	flex-flow:row;
      align-items: center;
      justify-content: center;
    }
  }

  .bang-player, #table {
    display:flex;
    flex-flow:row;
    align-items: center;
    grid-row-end:span 2;
    grid-column-end:span 2;
    max-height:$cardH + 20px;
    min-height:$cardH + 20px;
  }

  // TODO : add media query
  @each $nPlayers, $layout in $layoutBig {
    &[data-players="#{$nPlayers}"] #table {
      $place : map-get($layout, "table");
      grid-column-start: map-get($place, 'col');
      grid-row-start: map-get($place, 'row');
    }

    &[data-players="#{$nPlayers}"] .bang-player {
      @each $i, $place in $layout {
        @if $i != "table" {
          &[data-no="#{$i}"] {
            grid-column-start: map-get($place, 'col');
            grid-row-start: map-get($place, 'row');

            @if map-get($place, 'align') == left   { justify-content: flex-start; }
            @if map-get($place, 'align') == center { justify-content: center; }
            @if map-get($place, 'align') == right  { justify-content: flex-end; }
          }
        }
      }
    }
  }

  #table {
    justify-content:center;

    #table-container {
      width:2*$cardW + 30px;
      height:$cardH + 15px;
      background-color:$transparentWhite;
      border-radius:5px;
      border:1px solid $darkgray;
      box-shadow: 1px 1px 5px $darkgray;
      display:flex;
      flex-flow:row;
      align-items: center;
      justify-content: space-around;

      #deck, #discard {
        width:$cardW;
        height:$cardH;
        position:relative;

        &.selectable {
          cursor:pointer;
          animation:borderBlink 0.9s infinite;
        }
      }

      #deck {
        background-image:url("img/cardback.jpg");
        background-size:cover;
        background-position: center center;
        border-radius:7px;
        font-size:30px;
        text-shadow: 1px 1px 1px white, -1px -1px 1px white, -1px 1px 1px white, 1px -1px 1px white;
        display:flex;
        align-items: center;
        justify-content: center;
      }

      #discard div.bang-card {
        margin:0px;
        opacity:1 !important;
        position:absolute;
        top:0;
        left:0;
        transform-origin: -7% 50%;
      }
    }
  }


  div.bang-character-tooltip {
    div.bang-character-tooltip-sizing {
      width:2*$cardW * 113 / 106;
      height:2*($cardH + 10px);
      display:flex;
      justify-content: center;
      align-items: center;

      div.player-info {
        transform:scale(2);
      }
    }
  }

  .player-info {
    position:relative;
    width:$cardW / 106 * 113;
    height:$cardH + 10px;
    background-image:url("img/card_borders.png");
    background-size:cover;
    border-left:1px solid $darkgray;
    border-top-right-radius: 5px;
    border-bottom-right-radius: 5px;

    .player-character-name {
      font-family: "Perdido";
      width: 100%;
      max-height:22px;
      margin-top: 11px;
      text-align: center;
      font-size: 15px;
      transform: scale(0.8,1.3);
      transform-origin: top center;
    }

    .player-character-background {
      width: $cardW / 106 * 90;
      height: $cardH * 105 / 200;
      margin: 5px auto;
      background-image:url("img/card_characters.jpg");
      background-size:cover;
    }
    @for $i from 0 through $numberOfCharacters {
      &[data-character="#{$i}"] .player-character-background { background-position:$i * 100% / $numberOfCharacters center; }
    }
  }



  .bang-player {
    &.turn .bang-player-container {
//      border:1px solid blue;
    }

    &.inactive {
      opacity:0.6;
    }

    &.selectable {
      opacity:1;
      .player-info {
        cursor:pointer;
        animation:borderBlink 0.9s infinite;
        &:hover {
          animation:none;
          border:1px solid red;
        }

        @keyframes borderBlink {
          0%   { border: 1px dashed white; }
          49%  { border: 1px dashed white; }
          50%  { border: 1px dashed black; }
          99% { border: 1px dashed black; }
          100% { border: 1px dashed white; }
        }
      }
    }

    &.eliminated {
      .bang-player-container {
        width:$cardW / 106 * 113;

        .player-character-background {
          background-image:url("img/tombstone.svg");
          background-size: 80%;
          background-position: center center;
          background-repeat: no-repeat;
        }
      }
    }


    .bang-player-container {
      width:96%;
      height:$cardH + 10px;
      background-color:$transparentWhite;
      border-radius:5px;
      border:1px solid $darkgray;
      box-shadow: 1px 1px 5px $darkgray;
      display:flex;
      transition:width 1s;

      .player-inplay {
        flex-grow:1;
        display:flex;
        flex-flow:row;
      }

      .player-info {
        .player-name {
          text-align: center;
        }

        .player-cards {
          text-align: center;

          .player-hand-card {
            display:inline-block;
            width: 22px;
            height: 22px;
            background-image: url("img/cards.svg");
            background-size: contain;
            background-repeat: no-repeat;
            vertical-align: bottom;
          }
        }

        .player-bullets {
          position:absolute;
          width:30px;
          right:-8px;
          top:40px;

          .bullet {
            width: 35px;
            height: 13px;
            background-image: url("img/bullet.png");
            background-size: cover;
            margin: 1px 0px;
            transform: rotate(13deg);
            background-position:0% 100%;

            &.pulse {
              animation-duration: 1.8s;
              animation-name: pulsate;
              animation-iteration-count: 3;
            }
          }
        }

        .player-star {
          display:none;
          position:absolute;
          top: -17px;
          right: -12px;
          width: 30px;
          height: 34px;
          background-image:url("img/sheriff.svg");
          background-size:cover;
        }
      }
    }
    &[data-role="0"] .bang-player-container .player-info .player-star { display:block; }

    @for $maxBullets from 3 through 6 {
      @for $n from $maxBullets + 1 through 6 {
        &[data-max-bullets="#{$maxBullets}"] .bang-player-container .player-info .player-bullets .bullet:nth-child(#{$n}) { display:none; }
      }
    }

    @for $bullets from 0 through 6 {
      @for $n from 1 through $bullets {
        &[data-bullets="#{$bullets}"] .bang-player-container .player-info .player-bullets .bullet:nth-child(#{$n}) { background-position:0 0; }
      }
    }

    @for $i from 0 through 20 {
      &[data-hand="#{$i}"] .player-cards .player-handcount::before { content:"#{$i}"; }
    }
    @for $i from 0 through 7 {
      &[data-bullets="#{$i}"] .player-cards .player-maxhand::before { content:"#{$i}"; }
    }

    @for $i from 0 through 7 {
      @for $j from $i + 1 through 20 {
        &[data-bullets="#{$i}"][data-hand="#{$j}"] .player-cards { color:red; }
      }
    }

  }
}


div.bang-card-tooltip {
  div.bang-card-tooltip-sizing {
    width:2*$cardW;
    height:2*$cardH;
    display:flex;
    justify-content: center;
    align-items: center;

    div.bang-card {
      transform:scale(2);
    }
  }
}

div.bang-card {
	position:relative;
	width:$cardW;
	height:$cardH;
	margin:5px;
  transition: transform .5s ease-in-out;
  transform-origin: 50% 50%;
  transform-style: preserve-3d;
  &.flipped {
    transform:rotateY(180deg);
  }
  &[data-type="back"] {
    transform:rotateY(180deg);
  }


  &[data-type="empty"] {
    border:none !important;
    background:none !important;
    div {
      display:none;
    }
  }

  &.unselectable {
    opacity:0.5;
    cursor:not-allowed;
  }

  &.selectable {
    cursor:pointer;
    &:hover .card-front {
      transform:scale(1.05);
      transform-origin: center center;
    }
  }
  &.selected .card-front {
    transform:scale(1.05);
    transform-origin: center center;
    border: 2px solid red;
    border-radius: 7px;
    background-color: red;
  }


  .card-back, .card-front {
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    backface-visibility: hidden;
  }

  .card-back {
    background-image:url("img/cardback.jpg");
    background-size:cover;
    transform: rotateY(180deg);
    border-radius:10px;
    z-index:2;
  }

  @each $card in $actions    { &[data-type="#{$card}"] .card-front { background-position:1 * 100% / 3 center; } }
  @each $card in $equipments { &[data-type="#{$card}"] .card-front { background-position:2 * 100% / 3 center; } }
  @each $card in $guns       { &[data-type="#{$card}"] .card-front { background-position:3 * 100% / 3 center; } }

  @for $i from 0 through $numberOfCards {
    &[data-type="#{$i}"] .card-background { background-position:$i * 100% / $numberOfCards center; }
  }

  .card-front {
    background-image:url("img/card_borders.png");
    background-size:cover;

    .card-name {
    	position:absolute;
    	top: 12 * $cardH / 200;
    	width: 100%;
    	height: $cardH / 5;
    	text-align: center;
    	font-family: "Perdido";
    	font-size: $cardH * 21 / 200;
      letter-spacing: -1px;
      transform: scale(0.8,1.3);
      transform-origin: top center;
    }

    .card-background {
    	position:absolute;
    	top: $cardH * 42 / 200;
    	left: $cardW * 10 / 125;
    	width: $cardW * 105 / 125;
    	height: $cardH * 149 / 200;
    	background-image:url("img/card_backgrounds.jpg");
    	background-size:cover;
    }

    .card-copy {
      position: absolute;
      bottom: -3px;
      left: 4px;
      font-size: $cardH / 10;
      text-shadow: 1px 1px 1px white, -1px -1px 1px white, -1px 1px 1px white, 1px -1px 1px white;

      .card-copy-color {
        margin-left:-2px;
      }
      .card-copy-color::before {
        font-size:$cardH / 8;
      }
      .card-copy-color[data-color="D"]::before {
        content:"♦";
        color:red;
      }
      .card-copy-color[data-color="H"]::before {
        content:"♥";
        color:red;
      }
      .card-copy-color[data-color="S"]::before {
        content:"♠";
        color:black;
      }
      .card-copy-color[data-color="C"]::before {
        content:"♣";
        color:black;
      }
    }
  }
}

#popin_selectCard_contents {
  #dialog-card-container {
    display:flex;
  }

  #dialog-button-container {
    text-align:right;
  }
}


@keyframes pulsate {
  0% {
    transform:rotate(13deg) scale(1);
    box-shadow: 0 0 0 2px red;
  }
  50% {
    transform:rotate(13deg) scale(1.1);
    box-shadow: 0 0 0 10px transparent;
  }
}
